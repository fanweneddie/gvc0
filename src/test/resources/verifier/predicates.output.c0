#use <runtime>
struct Node;

struct Node
{
  int value;
  struct Node* next;
  int _id;
};

void add_wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter);
int fullyImprecise(struct Node* a, struct OwnedFields* _ownedFields, int* _instanceCounter);
int fullyPrecise(struct Node* a, int* _instanceCounter);
int imprecisePostcondition(struct Node* a, int* _instanceCounter);
int imprecisePrecondition(struct Node* a, struct OwnedFields* _ownedFields, int* _instanceCounter);
int main();
void sep_wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter);
void wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter);

void add_wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter)
{
  addAcc(_ownedFields, node->_id, 2, 0);
  addAcc(_ownedFields, node->_id, 2, 1);
}

int fullyImprecise(struct Node* a, struct OwnedFields* _ownedFields, int* _instanceCounter)
{
  assertAcc(_ownedFields, a != NULL ? a->_id : -1, 0, "Field access runtime check failed for struct Node.value");
  return a->value;
}

int fullyPrecise(struct Node* a, int* _instanceCounter)
{
  int _ = 0;
  struct OwnedFields* _ownedFields = NULL;
  struct OwnedFields* _tempFields = NULL;
  _ownedFields = initOwnedFields();
  add_wrappedAcc(a, _ownedFields, _instanceCounter);
  _ = imprecisePostcondition(a, _instanceCounter);
  _tempFields = initOwnedFields();
  wrappedAcc(a, _ownedFields, _instanceCounter);
  sep_wrappedAcc(a, _tempFields, _instanceCounter);
  return _;
}

int imprecisePostcondition(struct Node* a, int* _instanceCounter)
{
  return a->value;
}

int imprecisePrecondition(struct Node* a, struct OwnedFields* _ownedFields, int* _instanceCounter)
{
  assertAcc(_ownedFields, a != NULL ? a->_id : -1, 0, "Field access runtime check failed for struct Node.value");
  return a->value;
}

int main()
{
  struct Node* a = NULL;
  int _ = 0;
  int* _instanceCounter = NULL;
  _instanceCounter = alloc(int);
  a = alloc(struct Node);
  a->_id = *_instanceCounter;
  *_instanceCounter = *_instanceCounter + 1;
  a->next = NULL;
  _ = fullyPrecise(a, _instanceCounter);
  return _;
}

void sep_wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter)
{
  addAccEnsureSeparate(_ownedFields, node != NULL ? node->_id : -1, 0, 2, "Overlapping field permissions for struct Node.value");
  addAccEnsureSeparate(_ownedFields, node != NULL ? node->_id : -1, 1, 2, "Overlapping field permissions for struct Node.next");
}

void wrappedAcc(struct Node* node, struct OwnedFields* _ownedFields, int* _instanceCounter)
{
  assertAcc(_ownedFields, node != NULL ? node->_id : -1, 0, "Field access runtime check failed for struct Node.value");
  assertAcc(_ownedFields, node != NULL ? node->_id : -1, 1, "Field access runtime check failed for struct Node.next");
}
